{"version":3,"sources":["../src/module.js"],"names":["_","kbn","MetricsPanelCtrl","Builder","Sorter","panelDefaults","defaultColor","decimals","nameComponents","columns","sortColumn","sortMultiplier","Ctrl","$scope","$injector","defaults","panel","events","on","onInitEditMode","bind","onDataReceived","onRender","builder","sorter","rows","addEditorTab","unitFormats","getUnitFormats","seriesList","render","call","sort","push","title","regex","format","showDate","index","splice","column","value","toggle","valueFormats","icon","templateUrl"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAOA,O;;AACAC,S;;AACCC,sB,kBAAAA,gB;;AACAC,a,gBAAAA,O;;AACAC,Y,eAAAA,M;;;;;;;;;;;;;;;;;;;;;AAEFC,mB,GAAgB;AACpBC,sBAAc,oBADM;AAEpBC,kBAAU,CAFU;AAGpBC,wBAAgB,OAHI;AAIpBC,iBAAS,EAJW;AAKpBC,oBAAY,CAAC,CALO;AAMpBC,wBAAgB;AANI,O;;2BAShBC,I;;;AACJ,sBAAaC,MAAb,EAAqBC,SAArB,EAAgC;AAAA;;AAAA,kHACxBD,MADwB,EAChBC,SADgB;;AAE9Bd,YAAEe,QAAF,CAAW,MAAKC,KAAhB,EAAuBX,aAAvB;;AAEA,gBAAKY,MAAL,CAAYC,EAAZ,CAAe,gBAAf,EAAiC,MAAKC,cAAL,CAAoBC,IAApB,OAAjC;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,eAAf,EAAgC,MAAKG,cAAL,CAAoBD,IAApB,OAAhC;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,QAAf,EAAyB,MAAKI,QAAL,CAAcF,IAAd,OAAzB;;AAEA,gBAAKG,OAAL,GAAe,IAAIpB,OAAJ,CAAY,MAAKa,KAAjB,CAAf;AACA,gBAAKQ,MAAL,GAAc,IAAIpB,MAAJ,CAAW,MAAKY,KAAhB,CAAd;AACA,gBAAKS,IAAL,GAAY,EAAZ;AAV8B;AAW/B;;;;2CAEiB;AAChB,iBAAKC,YAAL,CAAkB,SAAlB,EAA6B,oDAA7B;AACA,iBAAKC,WAAL,GAAmB1B,IAAI2B,cAAJ,EAAnB;AACD;;;yCAEeC,U,EAAY;AAC1B,iBAAKA,UAAL,GAAkBA,UAAlB;AACA,iBAAKC,MAAL;AACD;;;qCAEW;AACV,iBAAKL,IAAL,GAAY,KAAKF,OAAL,CAAaQ,IAAb,CAAkB,KAAKF,UAAvB,CAAZ;AACA,iBAAKJ,IAAL,GAAY,KAAKD,MAAL,CAAYQ,IAAZ,CAAiB,KAAKP,IAAtB,CAAZ;AACD;;;mDAEyB;AACxB,iBAAKT,KAAL,CAAWP,OAAX,CAAmBwB,IAAnB,CAAwB,EAAEC,OAAO,EAAT,EAAaC,OAAO,EAApB,EAAwBC,QAAQ,MAAhC,EAAwCC,UAAU,KAAlD,EAAxB;AACA,iBAAKP,MAAL;AACD;;;oDAE0BQ,K,EAAO;AAChC,iBAAKtB,KAAL,CAAWP,OAAX,CAAmB8B,MAAnB,CAA0BD,KAA1B,EAAiC,CAAjC;AACA,iBAAKR,MAAL;AACD;;;+CAEqBM,M,EAAQI,M,EAAQ;AACpCA,mBAAOJ,MAAP,GAAgBA,OAAOK,KAAvB;AACA,iBAAKX,MAAL;AACD;;;wCAEcQ,K,EAAO;AACpB,iBAAKd,MAAL,CAAYkB,MAAZ,CAAmBJ,KAAnB;AACA,iBAAKR,MAAL;AACD;;;iCAEOW,K,EAAOH,K,EAAO;AACpB,gBAAIE,SAAS,KAAKxB,KAAL,CAAWP,OAAX,CAAmB6B,KAAnB,CAAb;AACA,mBAAOrC,IAAI0C,YAAJ,CAAiBH,OAAOJ,MAAxB,EAAgCK,KAAhC,EAAuC,KAAKzB,KAAL,CAAWT,QAAlD,EAA4D,IAA5D,CAAP;AACD;;;mCAES+B,K,EAAO;AACf,mBAAO,KAAKd,MAAL,CAAYoB,IAAZ,CAAiBN,KAAjB,CAAP;AACD;;;;QAxDgBpC,gB;;AA2DnBU,WAAKiC,WAAL,GAAmB,aAAnB;;2BACSjC,I","file":"module.js","sourcesContent":["import _ from 'lodash'\nimport kbn from 'app/core/utils/kbn'\nimport {MetricsPanelCtrl} from 'app/plugins/sdk'\nimport {Builder} from './util/builder'\nimport {Sorter} from './util/sorter'\n\nconst panelDefaults = {\n  defaultColor: 'rgb(117, 117, 117)',\n  decimals: 2,\n  nameComponents: '1,2,3',\n  columns: [],\n  sortColumn: -1,\n  sortMultiplier: 1\n}\n\nclass Ctrl extends MetricsPanelCtrl {\n  constructor ($scope, $injector) {\n    super($scope, $injector)\n    _.defaults(this.panel, panelDefaults)\n\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this))\n    this.events.on('data-received', this.onDataReceived.bind(this))\n    this.events.on('render', this.onRender.bind(this))\n\n    this.builder = new Builder(this.panel)\n    this.sorter = new Sorter(this.panel)\n    this.rows = []\n  }\n\n  onInitEditMode () {\n    this.addEditorTab('Options', 'public/plugins/btplc-peak-report-panel/editor.html')\n    this.unitFormats = kbn.getUnitFormats()\n  }\n\n  onDataReceived (seriesList) {\n    this.seriesList = seriesList\n    this.render()\n  }\n\n  onRender () {\n    this.rows = this.builder.call(this.seriesList)\n    this.rows = this.sorter.sort(this.rows)\n  }\n\n  onEditorAddColumnClick () {\n    this.panel.columns.push({ title: '', regex: '', format: 'none', showDate: false })\n    this.render()\n  }\n\n  onEditorRemoveColumnClick (index) {\n    this.panel.columns.splice(index, 1)\n    this.render()\n  }\n\n  onEditorFormatSelect (format, column) {\n    column.format = format.value\n    this.render()\n  }\n\n  onColumnClick (index) {\n    this.sorter.toggle(index)\n    this.render()\n  }\n\n  format (value, index) {\n    var column = this.panel.columns[index]\n    return kbn.valueFormats[column.format](value, this.panel.decimals, null)\n  }\n\n  sortIcon (index) {\n    return this.sorter.icon(index)\n  }\n}\n\nCtrl.templateUrl = 'module.html'\nexport { Ctrl as PanelCtrl }\n"]}